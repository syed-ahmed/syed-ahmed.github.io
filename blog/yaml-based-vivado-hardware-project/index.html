<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0">
<title data-rh="true">Creating Vivado Hardware Platform using YAML | Syed Tousif Ahmed</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://syed-ahmed.ai/blog/yaml-based-vivado-hardware-project"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Creating Vivado Hardware Platform using YAML | Syed Tousif Ahmed"><meta data-rh="true" name="description" content="The hardware design community have been following a design paradigm where you think of designing hardware spatially, i.e. start with a block diagram. I remember from my undergraduate logic design course, a block diagram was required before we started a lab assignment. It is the right approach for designing hardware. Vivado reinforces this paradigm by asking people to open the Vivado GUI, use the IP integrator and create a block design."><meta data-rh="true" property="og:description" content="The hardware design community have been following a design paradigm where you think of designing hardware spatially, i.e. start with a block diagram. I remember from my undergraduate logic design course, a block diagram was required before we started a lab assignment. It is the right approach for designing hardware. Vivado reinforces this paradigm by asking people to open the Vivado GUI, use the IP integrator and create a block design."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2020-06-02T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://syed-ahmed.ai"><meta data-rh="true" property="article:tag" content="vivado,fpga,tcl,yaml,hydra"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://syed-ahmed.ai/blog/yaml-based-vivado-hardware-project"><link data-rh="true" rel="alternate" href="https://syed-ahmed.ai/blog/yaml-based-vivado-hardware-project" hreflang="en"><link data-rh="true" rel="alternate" href="https://syed-ahmed.ai/blog/yaml-based-vivado-hardware-project" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://EM2ME1087F-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Syed Tousif Ahmed RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Syed Tousif Ahmed Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Syed Tousif Ahmed" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.89c51d9a.css">
<script src="/assets/js/runtime~main.40f6cfd4.js" defer="defer"></script>
<script src="/assets/js/main.993429e7.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">Syed Tousif Ahmed</b></a><a class="navbar__item navbar__link" href="/docs/intro">Engineering Notebook</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://syed-ahmed.ai/blog/rss.xml" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">RSS<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/yaml-based-vivado-hardware-project">Creating Vivado Hardware Platform using YAML</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/vivado-internal-params">Use All Tunable Vivado Internal Params</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/docker-workflow">Software Development Workflow with Docker</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="https://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="The hardware design community have been following a design paradigm where you think of designing hardware spatially, i.e. start with a block diagram. I remember from my undergraduate logic design course, a block diagram was required before we started a lab assignment. It is the right approach for designing hardware. Vivado reinforces this paradigm by asking people to open the Vivado GUI, use the IP integrator and create a block design."><header><h1 class="title_f1Hy" itemprop="headline">Creating Vivado Hardware Platform using YAML</h1><div class="container_mt6G margin-vert--md"><time datetime="2020-06-02T00:00:00.000Z" itemprop="datePublished">June 2, 2020</time> · <!-- -->6 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://syed-ahmed.ai" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/syed-ahmed/syed-ahmed.github.io/raw/main/website/static/img/profile-pic1.jpg" alt="Syed Tousif Ahmed" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://syed-ahmed.ai" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Syed Tousif Ahmed</span></a></div><small class="avatar__subtitle" itemprop="description">Software Engineer</small></div></div></div></div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><p>The hardware design community have been following a design paradigm where you think of designing hardware spatially, i.e. start with a block diagram. I remember from my undergraduate logic design course, a block diagram was required before we started a lab assignment. It is the right approach for designing hardware. Vivado reinforces this paradigm by asking people to open the Vivado GUI, use the IP integrator and create a block design. </p>
<p>An alternative to the GUI are the Vivado TCL commands. <img style="float:right;height:1000px" src="/assets/images/flow-6f408908c3c1a102114eea25d8242516.png">TCL is the scripting language of the hardware design community. If you wanted to generate block designs based on some input parameters, you would be using TCL. If you are developing on a headless server, you would have no other choice than to use TCL.
TCL programming is not bad, however, I&#x27;m very used to Python as my scripting language of choice. If you wanted to generate a block design that was data driven (for instance, use the decisions made by a PyTorch ML model or a Google OR-Tools model), you would need to introduce Python into the picture because TCL doesn&#x27;t have such packages.
If Python was a front-end for Vivado, our problem would have been solved! So how do we go from Python to TCL? People follow different approaches. You could write a Python script that generates a TCL file with the desired commands and parameters. You could use <a href="http://elmer.sourceforge.net/examples.html" target="_blank" rel="noopener noreferrer">elmer</a> to call Python from TCL (for instance, fork into a python class, get values from it and feed it to your TCL command), but elmer doesn&#x27;t work for Python3. While writing this post, I came to know about Olof Kindgren&#x27;s <a href="https://github.com/olofk/edalize" target="_blank" rel="noopener noreferrer">edalize</a> project! I&#x27;m taking a similar approach to this project, i.e. have a templated TCL script and use Python to feed those template parameters.
I generate a <code>yaml</code> configuration file from python and parse it in a TCL script. TCL has a yaml parser and can parse it to a TCL dictionary. You can then use the values from the dictionary in generic TCL functions. I discovered this <a href="https://github.com/Xilinx/wireless-apps/tree/master/scripts" target="_blank" rel="noopener noreferrer">repository</a> from Xilinx which uses a yaml configuration file in a TCL script to generate a vivado project. In addition, I found this excellent <a href="https://github.com/Xilinx/Vitis-AI/tree/master/DPU-TRD/prj/Vivado/scripts" target="_blank" rel="noopener noreferrer">Vivado hardware platform project</a> from Xilinx that uses TCL dicts to fully parameterize the generation of a block design. Combining these two, I have the approach on the right hand side.</p>
<p>Consider the following <code>yaml</code> file for one of our projects:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dict_prj:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dict_sys:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bd_name: floorplan_static</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bd_ooc: Hierarchical</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    prj_board: em.avnet.com:ultra96v2:part0:1.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    prj_name: floorplan_static</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    prj_part: xczu3eg-sbva484-1-e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dict_stgy:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    synth:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      synth_1:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        STRATEGY: &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        JOBS: 40</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    impl:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      impl_1_01:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PARENT: &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        STRATEGY: &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        JOBS: 40</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      impl_1_03:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PARENT: &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        STRATEGY: &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        JOBS: 40</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      impl_1_14:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PARENT: &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        STRATEGY: &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        JOBS: 40</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      impl_1_15:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PARENT: &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        STRATEGY: &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        JOBS: 40</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dict_xdc:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      NAME: pblocks.xdc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      IS_TARGET: True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dict_src:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      NAME: AxiLite2Bft_v2_0.v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      NAME: converter.v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dict_hier:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    h_bft:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      PATH: bft</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dict_ip:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ip_ps:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      PATH: zynq_ultra_ps_e_0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      NAME: zynq_ultra_ps_e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      VLNV: &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      PROP:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PSU__CRL_APB__PL1_REF_CTRL__ACT_FREQMHZ: &quot;19.660831&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PSU__FPGA_PL1_ENABLE: &quot;1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PSU__CRL_APB__PL1_REF_CTRL__SRCSEL: RPLL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PSU__PL_CLK1_BUF: &quot;TRUE&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PSU__SAXIGP2__DATA_WIDTH: &quot;32&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PSU__USE__S_AXI_GP2: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      BACFG:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        apply_board_preset: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ip_clk_rst_usr:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      PATH: rst_ps8_0_100M</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      NAME: proc_sys_reset</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      VLNV: &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      PROP: &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      BACFG: &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dict_pin:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    p_bft_S00_AXI:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      CLASS: INTF_PIN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      PATH: &quot;bft/S00_AXI&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      MODE: Slave</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      VLNV: &quot;xilinx.com:interface:aximm_rtl:1.0&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dict_cn:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cn_overlay:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      PIN intf PIN:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        zynq_ultra_ps_e_0/S_AXI_HP0_FPD: bft/M00_AXI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        zynq_ultra_ps_e_0/M_AXI_HPM0_FPD: bft/S00_AXI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        zynq_ultra_ps_e_0/M_AXI_HPM1_FPD: bft/S01_AXI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      PIN from PIN:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        bft/bft_0/dout_leaf_0: bft/AxiLite2Bft_v2_0_0/host_interface2bft</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        bft/leaf_interface_0/din_leaf_user2interface: bft/axi_dma_0/m_axis_mm2s_tdata</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        bft/leaf_interface_0/vld_user2interface: bft/axi_dma_0/m_axis_mm2s_tvalid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        bft/xlconcat_0/In0: bft/axi_dma_0/mm2s_introut</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        bft/xlconcat_0/In1: bft/axi_dma_1/s2mm_introut</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dict_addr:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addr_s00_axi:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      REG: bft/AxiLite2Bft_v2_0_0/s00_axi/reg0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      RANGE: 0x00001000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      OFFSET: 0xA0002000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can see that we have parameterized part and board numbers, since we want to support multiple boards with the same design. The PS IP is also parameterized since we want to support Zynq 7 series and Zynq UltraScale+. Similarly, you can see synthesis and implementation strategies are now parameterized, which means more design space exploration! Even connections of pins - we can now configure that with a python script if we want to generate a different overlay.</p>
<p>Following is how we are parsing the yaml in the TCL script:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#****************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># check if file exists</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#****************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">proc lib_check_file { file_name } {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    set file_content &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if { [ file exists  $file_name ] } {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        set fp [open $file_name r]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        set file_content [read $fp]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        close $fp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        lib_error YAML &quot;Cannot open filename $file_name...&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return $file_content</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#****************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># load yaml file into dict</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#****************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">proc lib_yaml2dict { file_name } {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    set file_content [ lib_check_file $file_name ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return [yaml::yaml2dict $file_content]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#****************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># set global dict_prj</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#****************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set dict_prj  {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set config_file &quot;config.yaml&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set cfg [lib_yaml2dict $config_file]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set dict_prj [dict get $cfg dict_prj]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The rest of the script is then from <a href="https://github.com/Xilinx/Vitis-AI/tree/master/DPU-TRD/prj/Vivado/scripts" target="_blank" rel="noopener noreferrer">Xilinx&#x27;s Vitis-AI repository</a>.
Now if you are wondering, why YAML? It&#x27;s solely because of <a href="https://hydra.cc/" target="_blank" rel="noopener noreferrer">hydra</a>. Hydra&#x27;s ability to compose a yaml file from a hierarchy of yaml files is a stunning feature that lets me focus on the parameters that matter in my project, and exactly fits our use case of supporting multiple moving things. For instance, Vivado is not backwards compatible and a set of parameters that worked in <code>2018.3</code> might not work in <code>2019.2</code>, for each board, Zynq7 and Zynq UltraScale+ PS parameters are different, and so on. Following is what my hydra conf looks like:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">├── conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── architecture</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   ├── board</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|       ├── pynq_z1.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|       ├── ultra96v2.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|       ├── zcu102.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|       ├── zed.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── vivado</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|       ├── 2018.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|           ├── ultra96v2.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|           ├── zcu102.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|       ├── 2019.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|           ├── zed.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   ├── config.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── generate_vivado_project.py</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>I can then execute the <code>generate_vivado_project.py</code> script with the command line parameters, such as <code>board=zed.yaml</code>, <code>vivado=2019.2</code> and it will generate a <code>config.yaml</code> which is the composition of the yaml files from the respective <code>conf</code> subdirectories. And now you can just source the tcl file with this config file! As a result, block design in vivado becomes a matter of writing a <code>yaml</code> file.</p>
<p>Now some cons of this approach - I have to find the names of the parameters, such as the Zynq IP parameters, AXI DMA parameters by trial-error in the GUI and then note it down in my configuration. This could be easily mitigated if all these parameters are nicely documented somewhere (or alternatively you could actually finish the design in GUI, export the TCL file and then note down the parameters from that TCL file...). Moreover, I like connecting the input and output of a block in the GUI than manually writing it in the <code>yaml</code> file. Hence, the way I see it, if you are prototyping and playing around with ideas, GUI approach is more flexible as I&#x27;m able to see the design like I would have done in my logic design lab assignments, whereas, when doing automation around generating hardware, templated TCL scripts with a configuration file is the way to go :).</p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/vivado">vivado</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/fpga">fpga</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/tcl">tcl</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/yaml">yaml</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/hydra">hydra</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/syed-ahmed/syed-ahmed.github.io/blob/main/website/blog/2020-06-02-yaml-based-vivado-hardware-project/index.md?plain=1" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--next" href="/blog/vivado-internal-params"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Use All Tunable Vivado Internal Params</div></a></nav></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Syed Tousif Ahmed.</div></div></div></footer></div>
</body>
</html>