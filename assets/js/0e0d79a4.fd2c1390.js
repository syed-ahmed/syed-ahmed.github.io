"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[8173],{838:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>t,contentTitle:()=>r,default:()=>h,frontMatter:()=>d,metadata:()=>c,toc:()=>o});var l=i(4848),s=i(8453);const d={},r="Exploring LLVM's Build System Features",c={id:"LLVM/llvm_techniques/Section 1/llvm_repo",title:"Exploring LLVM's Build System Features",description:"- build directives",source:"@site/docs/LLVM/llvm_techniques/Section 1/2_llvm_repo.md",sourceDirName:"LLVM/llvm_techniques/Section 1",slug:"/LLVM/llvm_techniques/Section 1/llvm_repo",permalink:"/docs/LLVM/llvm_techniques/Section 1/llvm_repo",draft:!1,unlisted:!1,editUrl:"https://github.com/syed-ahmed/syed-ahmed.github.io/blob/main/website/docs/LLVM/llvm_techniques/Section 1/2_llvm_repo.md?plain=1",tags:[],version:"current",sidebarPosition:2,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Installing LLVM",permalink:"/docs/LLVM/llvm_techniques/Section 1/install"},next:{title:"Testing with LLVM LIT",permalink:"/docs/LLVM/llvm_techniques/Section 1/testing_llvm_lit"}},t={},o=[{value:"LLVM&#39;s CMake directives",id:"llvms-cmake-directives",level:2},{value:"Adding New Libraries",id:"adding-new-libraries",level:3},{value:"Add one build target per folder",id:"add-one-build-target-per-folder",level:4},{value:"Adding executables and tools",id:"adding-executables-and-tools",level:3},{value:"Adding Pass plugins",id:"adding-pass-plugins",level:3},{value:"CMake integration for OOT project",id:"cmake-integration-for-oot-project",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.h1,{id:"exploring-llvms-build-system-features",children:"Exploring LLVM's Build System Features"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"build directives"}),"\n",(0,l.jsxs)(n.li,{children:["in tree/out of tree development","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"in tree: contribute code directly to llvm project."}),"\n",(0,l.jsx)(n.li,{children:"out of tree: creating llvm extensions."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"llvms-cmake-directives",children:"LLVM's CMake directives"}),"\n",(0,l.jsx)(n.h3,{id:"adding-new-libraries",children:"Adding New Libraries"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Don't use normal ",(0,l.jsx)(n.code,{children:"add_library"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:["Hard to control shared/static build of libraries using built in ",(0,l.jsx)(n.code,{children:"add_library"}),"."]}),"\n",(0,l.jsx)(n.li,{children:"Better control over RTTI and exception handling if not using built in directives."}),"\n",(0,l.jsxs)(n.li,{children:["Use ",(0,l.jsx)(n.code,{children:"add_llvm_component_library"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:["Example:","\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cmake",children:"add_llvm_component_library(<library name>\n\t<source file>)\n"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Instead of using ",(0,l.jsx)(n.code,{children:"target_link_libraries"})," and ",(0,l.jsx)(n.code,{children:"add_dependencies"}),", use ",(0,l.jsx)(n.code,{children:"LINK_COMPONENTS"})," argument\nin ",(0,l.jsx)(n.code,{children:"add_llvm_component_library"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:["Example:","\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cmake",children:"add_llvm_component_library(<library name>\n\t<source file>\n\tLINK_COMPONENTS\n\t<library 1> <library 2>)\n"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Can use ",(0,l.jsx)(n.code,{children:"LLVM_LINK_COMPONENTS"})," variable as well."]}),"\n",(0,l.jsxs)(n.li,{children:["Example:","\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cmake",children:"set(LLVM_LINK_COMPONENTS\n\t<library 1> <library 2>)\nadd_llvm_component_library(...)\n"})}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"Component libraries are llvm building blocks. Different than real library names."}),"\n",(0,l.jsxs)(n.li,{children:["Use ",(0,l.jsx)(n.code,{children:"llvm_map_components_to_libnames"})," to create mapping from component library name to real one."]}),"\n",(0,l.jsxs)(n.li,{children:["Use ",(0,l.jsx)(n.code,{children:"LINK_LIBS"})," argument of ",(0,l.jsx)(n.code,{children:"add_llvm_component_library"})," to link against normal lib."]}),"\n",(0,l.jsxs)(n.li,{children:["Use ",(0,l.jsx)(n.code,{children:"DEPENDS"})," argument to assign dependencies (instead of ",(0,l.jsx)(n.code,{children:"add_dependencies"}),")."]}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"add-one-build-target-per-folder",children:"Add one build target per folder"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Source file detection problem with LLVM Cmake functions."}),"\n",(0,l.jsx)(n.li,{children:"LLVM build enforces all C/C++ source files in the same folder are added to the same lib, executable or plugin."}),"\n",(0,l.jsxs)(n.li,{children:["Use ",(0,l.jsx)(n.code,{children:"add_subdirectory"})," to add sub-folders and separate out different libs with separate ",(0,l.jsx)(n.code,{children:"CMakeLists.txt"}),"."]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"adding-executables-and-tools",children:"Adding executables and tools"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Use ",(0,l.jsx)(n.code,{children:"add_llvm_executable"})," or ",(0,l.jsx)(n.code,{children:"add_llvm_tool"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:["Targets with ",(0,l.jsx)(n.code,{children:"add_llvm_tool"})," will be added in installations."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"LLVM_BUILD_TOOLS"})," enables/disables LLVM tool targets."]}),"\n",(0,l.jsxs)(n.li,{children:["Can use ",(0,l.jsx)(n.code,{children:"DEPENDS"}),"."]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"adding-pass-plugins",children:"Adding Pass plugins"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Use ",(0,l.jsx)(n.code,{children:"add_llvm_pass_plugin"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"LINK_COMPONENTS"}),", ",(0,l.jsx)(n.code,{children:"LINK_LIBS"}),", and ",(0,l.jsx)(n.code,{children:"DEPENDS"})," available."]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"cmake-integration-for-oot-project",children:"CMake integration for OOT project"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Two ways to create OOT project:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"llvm-config tool"}),"\n",(0,l.jsx)(n.li,{children:"LLVM CMake modules"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"Standard CMake package interface."}),"\n",(0,l.jsxs)(n.li,{children:["Use ",(0,l.jsx)(n.code,{children:"find_package(LLVM REQUIRED CONFIG)"})," to import configs."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"${LLVM_INCLUDE_DIRS}"})," and ",(0,l.jsx)(n.code,{children:"${LLVM_LIBRARY_DIRS}"})," for ",(0,l.jsx)(n.code,{children:"include_directories"})," and ",(0,l.jsx)(n.code,{children:"link_directories"}),",\nresolves include and library path."]}),"\n",(0,l.jsxs)(n.li,{children:["Use ",(0,l.jsx)(n.code,{children:"-DLLVM_DIR=<llvm install path>/lib/cmake/llvm"})," to find package."]}),"\n",(0,l.jsxs)(n.li,{children:["Import ",(0,l.jsx)(n.code,{children:"AddLLVM"})," to get LLVM CMake functions."]}),"\n",(0,l.jsxs)(n.li,{children:["Snippet:","\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cmake",children:"list(APPEND CMAKE_MODULE_PATH ${LLVM_CMAKE_DIR})\ninclude(AddLLVM)\n"})}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"Need to take LLVM definitions into account."}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"add_definitions(${LLVM_DEFINITIONS})"}),"."]}),"\n",(0,l.jsx)(n.li,{children:"LLVM not built with RTTI, but non-llvm applications are. Make sure no RTTI mismatch."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(a,{...e})}):a(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>c});var l=i(6540);const s={},d=l.createContext(s);function r(e){const n=l.useContext(d);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),l.createElement(d.Provider,{value:n},e.children)}}}]);